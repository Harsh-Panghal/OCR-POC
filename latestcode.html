<html>
  <head>
    <meta charset="UTF-8" />
    <title>PDF Viewer with Accurate OCR</title>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.16.105/pdf.min.js"></script>

    <script src="https://cdn.jsdelivr.net/npm/tesseract.js@5/dist/tesseract.min.js"></script>

    <style>
      body {
        margin: 0;
        display: flex;
        flex-direction: column;
        height: 100vh;
        font-family: "Segoe UI", Arial, sans-serif;
        background-color: #f3f4f6;
        overflow: hidden;
      }

      .top-bar {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 8px 20px;
        background: #ffffff;
        border-bottom: 1px solid #e5e7eb;
        box-shadow: 0 1px 2px rgba(0, 0, 0, 0.05);
        z-index: 10;
      }

      .main-container {
        display: flex;
        flex: 1;
        overflow: hidden;
      }

      #textPanel {
        width: 280px;
        min-width: 280px;
        overflow-y: auto;
        border-right: 1px solid #d1d5db;
        padding: 15px;
        background: #ffffff;
      }

      #textPanel h3 {
        font-size: 0.9rem;
        margin-top: 0;
        color: #1e40af;
        border-bottom: 2px solid #3b82f6;
        padding-bottom: 8px;
        margin-bottom: 15px;
      }

      #pdfPanel {
        flex-grow: 1;
        overflow-y: auto;
        overflow-x: auto;
        position: relative;
        background: #525659;
        display: flex;
        flex-direction: column;
        align-items: center;
        padding: 20px;
        cursor: grab;
      }

      #pdfPanel.is-dragging {
        cursor: grabbing;
        user-select: none; /* Drag karte waqt text select na ho */
      }

      /* --- Skeleton Animation --- */
      .skeleton {
        height: 40px;
        margin-bottom: 12px;
        background: linear-gradient(
          90deg,
          #f1f5f9 25%,
          #e2e8f0 50%,
          #f1f5f9 75%
        );
        background-size: 200% 100%;
        animation: shimmer 1.5s infinite;
        border-radius: 6px;
      }
      @keyframes shimmer {
        0% {
          background-position: 200% 0;
        }
        100% {
          background-position: -200% 0;
        }
      }

      /* --- Toast Styling --- */
      #toast {
        visibility: hidden;
        min-width: 250px;
        background-color: #10b981;
        color: #fff;
        text-align: center;
        border-radius: 8px;
        padding: 16px;
        position: fixed;
        z-index: 100;
        right: 30px;
        bottom: 30px;
        font-size: 14px;
        font-weight: 600;
        box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.2);
      }
      #toast.show {
        visibility: visible;
        animation:
          fadein 0.5s,
          fadeout 0.5s 2.5s;
      }
      @keyframes fadein {
        from {
          bottom: 0;
          opacity: 0;
        }
        to {
          bottom: 30px;
          opacity: 1;
        }
      }
      @keyframes fadeout {
        from {
          bottom: 30px;
          opacity: 1;
        }
        to {
          bottom: 0;
          opacity: 0;
        }
      }

      /* --- Improved Scrollbars --- */
      #textPanel::-webkit-scrollbar,
      #pdfPanel::-webkit-scrollbar {
        width: 6px;
      }
      #textPanel::-webkit-scrollbar-thumb,
      #pdfPanel::-webkit-scrollbar-thumb {
        background: transparent;
        border-radius: 10px;
      }
      #textPanel:hover::-webkit-scrollbar-thumb {
        background: rgba(0, 0, 0, 0.15);
      }
      #pdfPanel:hover::-webkit-scrollbar-thumb {
        background: rgba(255, 255, 255, 0.2);
      }

      /* --- Vertical Layout Field --- */
      .text-line {
        position: relative; /* Label ko iske andar absolute position karne ke liye */
        padding: 20px 10px 8px 10px; /* Top padding badhayi taaki label ke liye jagah ban jaye */
        margin-bottom: 10px; /* Cards ke beech ka gap kam kar diya */
        background: #f8fafc;
        border: 1px solid #e2e8f0;
        border-left-width: 5px;
        border-left-style: solid;
        border-radius: 6px;
        transition: all 0.2s ease;
        cursor: text; /* Pura card text input jaisa feel hoga */
        box-shadow: 0 1px 2px rgba(0, 0, 0, 0.02);
      }

      /* Confidence Colors applied to left border */
      .text-line.conf-high {
        border-left-color: #10b981;
      } /* Green */
      .text-line.conf-medium {
        border-left-color: #f59e0b;
      } /* Yellow */
      .text-line.conf-low {
        border-left-color: #ef4444;
      } /* Red */

      /* Label now sits inside the top-left of the card */
      .text-line strong {
        position: absolute;
        top: 4px;
        left: 10px;
        color: #64748b;
        font-size: 10px;
        text-transform: uppercase;
        letter-spacing: 0.5px;
        pointer-events: none; /* Taaki label par click karne se bhi cursor value par jaye */
      }

      /* Editable Value Box - Now blends seamlessly */
      .val-content {
        display: block;
        width: 100%;
        outline: none;
        word-break: break-all;
        color: #0f172a;
        font-weight: 500;
        font-size: 13px;
        min-height: 16px;
        background: transparent; /* Card ka hi background use hoga */
        border: none; /* Andar ka border hata diya */
      }

      /* Focus effect ab pure card par aayega */
      .text-line:focus-within {
        background: #ffffff;
        /* border-color: #3b82f6; */
        box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.15);
      }

      /* Edited State */
      .text-line.is-edited {
        background: #eef2ff;
        border-top-color: #c7d2fe;
        border-right-color: #c7d2fe;
        border-bottom-color: #c7d2fe;
      }

      .text-line.is-edited .val-content {
        border-color: #c7d2fe;
      }

      /* --- PDF Area --- */
      .page {
        position: relative;
        margin-bottom: 25px;
        box-shadow: 0 8px 25px rgba(0, 0, 0, 0.3);
        background: white;
      }

      canvas {
        display: block;
      }

      .highlight {
        position: absolute;
        border: 2px solid #3b82f6;
        background: rgba(59, 130, 246, 0.25);
        pointer-events: none;
        border-radius: 2px;
      }

      /* --- Buttons --- */
      .btn-refresh,
      .btn-save {
        padding: 8px 16px;
        cursor: pointer;
        border: none;
        border-radius: 6px;
        font-size: 12px;
        font-weight: 600;
        transition: 0.2s;
      }
      .btn-refresh {
        background: #f1f5f9;
        color: #475569;
      }
      .btn-refresh:hover {
        background: #e2e8f0;
      }
      .btn-save {
        background: #10b981;
        color: white;
        margin-left: 8px;
      }
      .btn-save:disabled {
        background: #cbd5e1;
        color: #94a3b8;
        cursor: not-allowed;
      }
      .btn-save:not(:disabled):hover {
        background: #059669;
        transform: translateY(-1px);
      }

      /* --- Zoom Controls (Fixed at Top-Right) --- */
      .zoom-toolbar {
        position: absolute;
        top: 20px; /* Top se distance */
        right: 30px; /* Right se distance */
        background: #1e293b;
        color: white;
        padding: 6px 12px;
        border-radius: 20px;
        display: flex;
        align-items: center;
        gap: 12px;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
        z-index: 100; /* Hamesha PDF ke upar rahega */
        opacity: 0.9;
        transition: opacity 0.2s;
      }

      .zoom-toolbar:hover {
        opacity: 1;
      }

      .zoom-btn {
        background: transparent;
        color: white;
        border: none;
        font-size: 18px;
        cursor: pointer;
        padding: 0 6px;
        border-radius: 50%;
        transition: background 0.2s;
      }

      .zoom-btn:hover {
        background: #334155;
      }

      #zoomVal {
        font-size: 13px;
        font-weight: 600;
        min-width: 45px;
        text-align: center;
        user-select: none;
      }

      /* PDF Wrapper jisme zoom apply hoga */
      #pdfWrapper {
        width: 100%;
        display: flex;
        flex-direction: column;
        align-items: center;
        transition: zoom 0.2s ease;
      }

      /* --- Info Icon & Tooltip --- */
      .info-icon {
        position: absolute;
        top: 4px;
        right: 8px;
        color: #94a3b8;
        cursor: pointer; /* 'help' se 'pointer' kar diya kyunki ab clickable hai */
        display: flex;
        align-items: center;
        justify-content: center;
        width: 22px; /* Size increase kiya (Pehle 16px tha) */
        height: 22px; /* Size increase kiya */
        border-radius: 50%;
        transition:
          background-color 0.2s,
          color 0.2s;
      }

      .info-icon:hover {
        color: #3b82f6;
        background-color: #f1f5f9; /* Hover par halka background for better feel */
      }

      .info-icon svg {
        width: 18px; /* SVG icon bhi bada kiya (Pehle 14px tha) */
        height: 18px;
        fill: currentColor;
      }

      /* Tooltip base style same rahegi */
      .tooltip-text {
        visibility: hidden;
        width: max-content;
        max-width: 200px;
        background-color: #1e293b;
        color: #fff;
        text-align: left;
        border-radius: 6px;
        padding: 6px 10px;
        font-size: 11px;
        font-weight: 500;
        line-height: 1.4;
        position: absolute;
        z-index: 150;
        bottom: 130%;
        right: -5px;
        opacity: 0;
        transition:
          opacity 0.2s ease,
          transform 0.2s ease;
        transform: translateY(5px);
        box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
      }

      .tooltip-text::after {
        content: "";
        position: absolute;
        top: 100%;
        right: 12px; /* Arrow alignment adjust kiya naye size ke hisaab se */
        margin-left: -5px;
        border-width: 5px;
        border-style: solid;
        border-color: #1e293b transparent transparent transparent;
      }

      /* --- NEW: Click par ye class add hogi JS ke through --- */
      .tooltip-text.show {
        visibility: visible;
        opacity: 1;
        transform: translateY(0);
      }
    </style>
  </head>

  <body onload="OnLoad()">
    <div class="top-bar">
      <div style="font-size: 14px; font-weight: 700; color: #1e40af">
        OGRE OCR VIEWER
      </div>
      <div>
        <button class="btn-refresh" onclick="refreshPage()">Refresh</button>
        <button id="saveBtn" class="btn-save" onclick="handleSave()" disabled>
          Save Changes
        </button>
      </div>
    </div>

    <div class="main-container" style="position: relative">
      <div id="textPanel">
        <h3>Extracted Text</h3>
        <div id="skeleton-container"></div>
      </div>

      <div class="zoom-toolbar">
        <button class="zoom-btn" onclick="zoomOut()" title="Zoom Out">−</button>
        <span id="zoomVal">100%</span>
        <button class="zoom-btn" onclick="zoomIn()" title="Zoom In">+</button>

        <div
          style="width: 1px; height: 16px; background: #475569; margin: 0 4px"
        ></div>

        <button
          class="zoom-btn"
          onclick="resetZoom()"
          title="Reset Zoom"
          style="font-size: 16px"
        >
          ↺
        </button>
      </div>

      <div id="pdfPanel">
        <div id="pdfWrapper"></div>
      </div>
    </div>

    <div id="toast">Changes Saved Successfully!</div>

    <script>
      function refreshPage() {
        location.reload();
      }

      const SCALE = 2;
      let pdfUrl =
        "./5a312567-5db9-f011-bbd3-7c1e521d650e_7d48cf8c-1bea-f011-8406-6045bd0e6caa_05012026113514.pdf";

      // Include dummy confidence values for UI demonstration
      const filterJson = [
        {
          "Job no": "NJ22AOV",
          confidence: 0.95,
          description:
            "The unique reference number assigned to this specific repair job.",
        },
        {
          "VEHICLE REG NO": "45800",
          confidence: 0.65,
          description: "Official registration plate number of the vehicle.",
        },
        {
          "Chasis REG NO": "UN03385735",
          confidence: 0.4,
          description:
            "The unique 17-character Vehicle Identification Number (VIN).",
        },
        {
          "Serial No": "10713439",
          confidence: 0.88,
          description:
            "Manufacturer's serial number for the specific part or engine.",
        },
        {
          "Tyre pressure": "100.0",
          confidence: 0.92,
          description: "The air pressure in the vehicle's tires (in kPa).",
        },
        {
          "DSRC serial no": "9254",
          confidence: 0.58,
          description:
            "The unique 17-character Vehicle Identification Number (VIN).",
        },
        {
          Type: "Goods",
          confidence: 0.42,
          description: "The type of vehicle or cargo being transported.",
        },
        {
          "DSRC ": "OK",
          confidence: 0.5,
          description:
            "The unique 17-character Vehicle Identification Number (VIN).",
        },
      ];

      let filterValues = [];
      const shownValues = new Set();
      const pageWrappers = {};

      pdfjsLib.GlobalWorkerOptions.workerSrc =
        "https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.16.105/pdf.worker.min.js";

      var _Xrm;
      var _formContext;

      // Skeleton UI Functions
      function showSkeletons() {
        const container = document.getElementById("skeleton-container");
        container.innerHTML = "";
        for (let i = 0; i < 7; i++) {
          const skel = document.createElement("div");
          skel.className = "skeleton";
          container.appendChild(skel);
        }
      }

      function hideSkeletons() {
        const container = document.getElementById("skeleton-container");
        if (container) container.style.display = "none";
      }

      // Toast Notification Function
      function showToast() {
        const x = document.getElementById("toast");
        x.className = "show";
        setTimeout(function () {
          x.className = x.className.replace("show", "");
        }, 3000);
      }

      // Clear all highlights globally
      function removeHighlights() {
        document.querySelectorAll(".highlight").forEach((h) => h.remove());
      }

      // Clear highlights when clicking empty PDF space
      document.getElementById("pdfPanel").addEventListener("click", (e) => {
        if (e.target.id === "pdfPanel" || e.target.className === "page") {
          removeHighlights();
        }
      });

      async function OnLoad() {
        //Xrm, formContext) {
        debugger;
        showSkeletons();
        try {
          //if (Xrm != null && Xrm != undefined)
          //    _Xrm = Xrm;
          //else
          //    _Xrm = window.parent.Xrm;

          //if (formContext != null && formContext != undefined)
          //    _formContext = formContext;
          //else
          //    _formContext = window.parent.Xrm.Page.ui.formContext;

          //let filterJson = null;

          //const attr = _formContext.getAttribute("ogre_document_key_values");

          //if (attr) {
          //    const value = attr.getValue();

          //    if (value && value.trim() !== "") {
          //        try {
          //            filterJson = JSON.parse(value);
          //        } catch (e) {
          //            console.error("Invalid JSON in ogre_document_key_values field:", e);
          //            return;
          //        }
          //    }
          //}

          //let recordId = _formContext.data.entity.getId();

          //if (recordId) {
          //    recordId = recordId.replace(/[{}]/g, "");
          //}

          // pdfUrl = `https://ogre-dev.crm11.dynamics.com/api/data/v9.0/ogre_ocrdocuments(${recordId})/ogre_file/$value`;

          filterValues = filterJson.map((obj) => {
            const key = Object.keys(obj)[0];
            const value = Object.values(obj)[0];
            const conf = obj.confidence || 1.0;
            const desc = obj.description || ""; // Description fetch kiya
            return {
              key: key,
              value: value.toString().trim().toLowerCase(),
              confidence: conf,
              description: desc,
            };
          });

          const pdf = await pdfjsLib.getDocument(pdfUrl).promise;
          for (let i = 1; i <= pdf.numPages; i++) {
            const page = await pdf.getPage(i);
            await renderPage(page);
            await extractText(page);
          }
          hideSkeletons();
        } catch (e) {
          hideSkeletons();
          // SetStatus("Unknown problem occurred. Error: " + e);
          console.log(e);
        }
      }

      // --- Zoom Logic ---
      let currentZoom = 1.0;

      function zoomIn() {
        if (currentZoom < 2.5) {
          // Max zoom 250%
          currentZoom += 0.1;
          applyZoom();
        }
      }

      function zoomOut() {
        if (currentZoom > 0.5) {
          // Min zoom 50%
          currentZoom -= 0.1;
          applyZoom();
        }
      }

      // --- Reset Zoom Logic ---
      function resetZoom() {
        if (currentZoom !== 1.0) {
          // Agar pehle se 100% nahi hai tabhi chalega
          currentZoom = 1.0;
          applyZoom();
        }
      }

      function applyZoom() {
        const wrapper = document.getElementById("pdfWrapper");
        const zoomText = document.getElementById("zoomVal");

        wrapper.style.zoom = currentZoom;
        zoomText.innerText = Math.round(currentZoom * 100) + "%";
      }

      async function renderPage(page) {
        const viewport = page.getViewport({ scale: SCALE });
        const canvas = document.createElement("canvas");
        const ctx = canvas.getContext("2d");
        canvas.width = viewport.width;
        canvas.height = viewport.height;
        const wrapper = document.createElement("div");
        wrapper.className = "page";
        wrapper.appendChild(canvas);

        // Puraana code: document.getElementById("pdfPanel").appendChild(wrapper);
        // Naya code: Ab page pdfWrapper ke andar jayega
        document.getElementById("pdfWrapper").appendChild(wrapper);

        pageWrappers[page.pageNumber] = wrapper;
        await page.render({ canvasContext: ctx, viewport }).promise;
      }

      async function extractText(page) {
        const viewport = page.getViewport({ scale: SCALE });
        const textContent = await page.getTextContent();
        if (textContent.items.length > 0)
          extractNormalPDFText(page, textContent, viewport);
        else await extractScannedPDFText(page);
      }

      function extractNormalPDFText(page, tc, viewport) {
        tc.items.forEach((item) => {
          if (!item.str.trim()) return;
          const pdfText = item.str.trim();
          const normalizedPdfText = pdfText.toLowerCase();
          const matchObj = filterValues.find(
            (f) => f.value === normalizedPdfText,
          );

          if (!matchObj || shownValues.has(matchObj.key)) return;
          shownValues.add(matchObj.key);

          const tx = pdfjsLib.Util.transform(
            viewport.transform,
            item.transform,
          );

          createTextLine(
            page.pageNumber,
            matchObj.key,
            pdfText,
            matchObj.confidence,
            matchObj.description,
            tx[4],
            tx[5] - item.height * SCALE,
            item.width * SCALE,
            item.height * SCALE,
          );
        });
      }

      async function extractScannedPDFText(page) {
        const canvas = pageWrappers[page.pageNumber].querySelector("canvas");
        preprocessCanvas(canvas);
        const worker = await Tesseract.createWorker("eng");
        await worker.setParameters({
          tessedit_pageseg_mode: Tesseract.PSM.SINGLE_BLOCK,
          tessedit_char_whitelist:
            "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789:/-",
          preserve_interword_spaces: "1",
        });
        const { data } = await worker.recognize(canvas);
        await worker.terminate();
        data.words.forEach((w) => {
          const pdfText = w.text.trim();
          const normalizedPdfText = pdfText.toLowerCase();
          const matchObj = filterValues.find(
            (f) => f.value === normalizedPdfText,
          );

          if (!matchObj || shownValues.has(matchObj.key)) return;
          shownValues.add(matchObj.key);

          createTextLine(
            page.pageNumber,
            matchObj.key,
            pdfText,
            matchObj.confidence,
            matchObj.description,
            w.bbox.x0,
            w.bbox.y0,
            w.bbox.x1 - w.bbox.x0,
            w.bbox.y1 - w.bbox.y0,
          );
        });
      }

      function preprocessCanvas(canvas) {
        const ctx = canvas.getContext("2d");
        const imgData = ctx.getImageData(0, 0, canvas.width, canvas.height);
        const d = imgData.data;
        for (let i = 0; i < d.length; i += 4) {
          const gray = d[i] * 0.3 + d[i + 1] * 0.59 + d[i + 2] * 0.11;
          const val = gray > 160 ? 255 : 0;
          d[i] = d[i + 1] = d[i + 2] = val;
        }
        ctx.putImageData(imgData, 0, 0);
      }

      function createTextLine(
        page,
        key,
        value,
        confidence,
        description,
        left,
        top,
        width,
        height,
      ) {
        const div = document.createElement("div");

        let colorClass = "conf-high";
        if (confidence < 0.5) {
          colorClass = "conf-low";
        } else if (confidence < 0.8) {
          colorClass = "conf-medium";
        }

        div.className = `text-line ${colorClass}`;
        div.setAttribute("data-key", key);
        div.setAttribute("data-original", value);
        div.setAttribute("data-confidence", confidence);

        // SVG icon for professional look
        let infoHtml = "";
        if (description) {
          infoHtml = `
            <div class="info-icon" onclick="toggleTooltip(event, this)">
              <svg viewBox="0 0 24 24">
                <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 15h-2v-6h2v6zm0-8h-2V7h2v2z"/>
              </svg>
              <div class="tooltip-text">${description}</div>
            </div>
          `;
        }

        // HTML Inject (Info icon top-right pe set ho jayega)
        div.innerHTML = `
          <strong>${key}</strong> 
          ${infoHtml}
          <span class="val-content" contenteditable="true" spellcheck="false">${value}</span>
        `;

        div.onclick = (e) => {
          const span = div.querySelector(".val-content");
          if (document.activeElement !== span) {
            span.focus();
          }
          highlight(page, left, top, width, height);
        };

        const span = div.querySelector(".val-content");

        span.oninput = () => {
          const currentVal = span.innerText.trim();
          const originalVal = div.getAttribute("data-original").trim();
          if (currentVal !== originalVal) div.classList.add("is-edited");
          else div.classList.remove("is-edited");
          checkEnableSave();
        };

        document.getElementById("textPanel").appendChild(div);
      }

      function checkEnableSave() {
        const hasChanges = document.querySelectorAll(".is-edited").length > 0;
        document.getElementById("saveBtn").disabled = !hasChanges;
      }

      function handleSave() {
        const updatedData = [];

        document.querySelectorAll(".text-line").forEach((div) => {
          const key = div.getAttribute("data-key");
          const value = div.querySelector(".val-content").innerText.trim();
          const confidence = parseFloat(div.getAttribute("data-confidence"));

          // Reconstruct the array of objects structure
          updatedData.push({
            [key]: value,
            confidence: confidence,
          });
        });

        console.log("Updated JSON:", JSON.stringify(updatedData, null, 2));

        // Show success notification
        showToast();

        // Reset state after save
        document.querySelectorAll(".is-edited").forEach((el) => {
          el.setAttribute(
            "data-original",
            el.querySelector(".val-content").innerText,
          );
          el.classList.remove("is-edited");
        });

        checkEnableSave();
      }

      function highlight(page, left, top, width, height) {
        const wrapper = pageWrappers[page];

        removeHighlights();

        const h = document.createElement("div");
        h.className = "highlight";
        h.style.left = left + "px";
        h.style.top = top + "px";
        h.style.width = width + "px";
        h.style.height = height + "px";

        wrapper.appendChild(h);
        h.scrollIntoView({ behavior: "smooth", block: "center" });
      }

      // --- Tooltip Click Logic ---

      // Icon par click karne se kya hoga
      function toggleTooltip(event, element) {
        // Event ko parent (text-line) tak jaane se rokta hai, warna PDF highlight trigger ho jayega
        event.stopPropagation();

        const tooltip = element.querySelector(".tooltip-text");
        const isAlreadyVisible = tooltip.classList.contains("show");

        // Pehle saare open tooltips ko band karo
        document.querySelectorAll(".tooltip-text.show").forEach((el) => {
          el.classList.remove("show");
        });

        // Agar clicked tooltip band tha, to use khol do
        if (!isAlreadyVisible) {
          tooltip.classList.add("show");
        }
      }

      // Kahi aur click karne par saare tooltips band ho jayenge
      document.addEventListener("click", function () {
        document.querySelectorAll(".tooltip-text.show").forEach((el) => {
          el.classList.remove("show");
        });
      });

      // --- Drag to Pan (Scroll) Logic ---
      const pdfPanel = document.getElementById("pdfPanel");
      let isDragging = false;
      let startX, startY, scrollLeft, scrollTop;

      // Jab mouse button press ho
      pdfPanel.addEventListener("mousedown", (e) => {
        // Agar zoom toolbar ke buttons pe click kiya hai toh drag start mat karo
        if (e.target.closest(".zoom-toolbar")) return;

        isDragging = true;
        pdfPanel.classList.add("is-dragging");

        // Initial positions record karo
        startX = e.pageX - pdfPanel.offsetLeft;
        startY = e.pageY - pdfPanel.offsetTop;
        scrollLeft = pdfPanel.scrollLeft;
        scrollTop = pdfPanel.scrollTop;
      });

      // Jab mouse leave kare ya button chhod de
      pdfPanel.addEventListener("mouseleave", () => {
        isDragging = false;
        pdfPanel.classList.remove("is-dragging");
      });

      pdfPanel.addEventListener("mouseup", () => {
        isDragging = false;
        pdfPanel.classList.remove("is-dragging");
      });

      // Jab mouse move kare
      pdfPanel.addEventListener("mousemove", (e) => {
        if (!isDragging) return;

        e.preventDefault(); // Default behaviour roko (jaise text selection)

        const x = e.pageX - pdfPanel.offsetLeft;
        const y = e.pageY - pdfPanel.offsetTop;

        // Kitna move karna hai (1.5 multiplier thoda fast pan karne ke liye hai)
        const walkX = (x - startX) * 1.5;
        const walkY = (y - startY) * 1.5;

        // Scroll position update karo
        pdfPanel.scrollLeft = scrollLeft - walkX;
        pdfPanel.scrollTop = scrollTop - walkY;
      });
    </script>
  </body>
</html>
